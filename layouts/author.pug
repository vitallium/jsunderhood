extend page

block meta
  meta(name="og:title"        content=title)
  meta(name="og:url"          content=site.site_url + author.username + "/")
  if (author.media && author.media.image)
    meta(name="og:image"        content=site.site_url + author.media.image.replace('./', ''))
  meta(property="description" content=author.tweets[0].full_text ? author.tweets[0].full_text : author.tweets[0].text)
  meta(name="og:description"  content=author.tweets[0].full_text ? author.tweets[0].full_text : author.tweets[0].text)

block headerTitle
  a(href="/")= underhood.underhood
  .d-inline-block= " / " + author.username

block content
  .container
    .row
      .col-sm-12.col-md-6.offset-md-3
        article
          .title
            if (author.media && author.media.image)
              img.rounded-circle.author-image(src=author.media.image.replace('./', '/'))
            h1= author.username
              = " "
              small: small: a(href="https://twitter.com/" + author.username)
                i.fa.fa-external-link-alt
            p
              i= helpers.authorRender.d(author.tweets[0].created_at)
              if author.info.location
                = ", "
                i.fa.fa-map-marker
                = " " + author.info.location

          each weekday in helpers.authorRender.prepareTweets(author.tweets)
            - var weekdayID = helpers.authorRender.unidecode(weekday.weekday);
            h2(id=weekdayID)
              a(href="#" + weekdayID) #
              = " " + helpers.authorRender.capitalize(weekday.weekday)
              small= " " + helpers.authorRender.tweetsUnit(weekday.tweets.length)

            each tweet in weekday.tweets
              - var isRetweet = !!tweet.retweeted_status;
              - var isQuoted = !!tweet.quoted_status;
              .tweet(class=isQuoted ? 'tweet--is-quoted' : '')
                if isRetweet
                  - var retweetedUser = tweet.entities.user_mentions[0].screen_name;
                  blockquote
                    != helpers.authorRender.render(tweet.retweeted_status)
                    if tweet.entities.media
                      - var getImageHttps = function (item) { return item.media_url_https; };
                      - var images = tweet.entities.media.map(getImageHttps);
                      for image in images
                        img.img-fluid(src=image)
                    footer
                      a(href="https://twitter.com/" + retweetedUser)
                        = "@" + retweetedUser
                else if isQuoted
                  - var quotedUser = helpers.authorRender.getQuotedUser(tweet);
                  blockquote
                    != helpers.authorRender.render(tweet.quoted_status)
                    if tweet.entities.media
                      - var getImageHttps = function (item) { return item.media_url_https; };
                      - var images = tweet.entities.media.map(getImageHttps);
                      for image in images
                        img.img-fluid(src=image)
                    footer
                      a(href="https://twitter.com/" + quotedUser)
                        = "@" + quotedUser
                  p
                    != helpers.authorRender.render(tweet)
                    if tweet.entities.media
                      - var getImageHttps = function (item) { return item.media_url_https; };
                      - var images = tweet.entities.media.map(getImageHttps);
                      for image in images
                        img.img-fluid(src=image)
                else
                  p
                    != helpers.authorRender.render(tweet)
                    if tweet.entities.media
                      - var getImageHttps = function (item) { return item.media_url_https; };
                      - var images = tweet.entities.media.map(getImageHttps);
                      for image in images
                        img.img-fluid(src=image)
                a.tweet__time(href=helpers.authorRender.tweetLink(tweet))= helpers.authorRender.tweetTime(tweet)

          h2(id="links")
            a(href="#links") #
            = " Ссылки"
          each group in helpers.authorRender.getLinks(author.tweets)
            h3= group.host
            ul.list--links
              each link in group.links
                li: a(href=link)= link

      .col-12
          hr
          - var prev = helpers.authorRender.prevAuthor(author);
          - var next = helpers.authorRender.nextAuthor(author);
          .container-fluid
            .row
              if prev
                .col-xs-6.text-left
                  .h3.author-prev-next
                    = "← "
                    if (prev.media && prev.media.image)
                      img.rounded-circle.author-image.author-image--small(src=prev.media.image.replace('./', '/'))
                    = " "
                    a(href="/" + prev.authorId)= "@" + prev.username
              if next
                .col-xs-6.ml-auto.text-right(class= !prev ? 'offset-6' : '')
                  .h3.author-prev-next
                    a(href="/" + next.authorId)= "@" + next.username
                    = " "
                    if (next.media && next.media.image)
                      img.rounded-circle.author-image.author-image--small(src=next.media.image.replace('./', '/'))
                    =" →"
          hr
